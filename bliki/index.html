<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Kjell-Magne Øierud :: Bliki</title>
    <meta name="author" content="" />

    <!-- CodeRay syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/coderay.css" type="text/css" />
 
    <!-- Homepage CSS -->
    <link rel="stylesheet" href="/css/site.css" type="text/css" media="screen, projection" />

    <script type="text/javascript" src="/main.js"></script>
  </head>
  <body>
    <div id="container">
      
<h1>Kjell-Magne Øierud :: Bliki</h1>

<p id="subtitle">Thoughts on software development

<div id="menu"><span style="float:left;">[ <a href="..">Home</a> ] [ <a href="."><strong>Blog</strong></a> ] [ <a href="../code">Code</a> ]</span><span style="float: right;">[ <a href="feed.atom">Feed</a> ]</span></div>
      

 
  <div class="date">2010-02-18 21:22 CET</div>

<h2><a href="/bliki/AchooTheAchievoCLI.html">Achoo --- The Achievo CLI</a></h2>


<p>To ease the pain of hour registration, I have created a command
line shell for the hour registration system we use at Redpill Linpro
-- <a href="http://achievo.org">Achievo</a>.

<p>The code is hosted on Github, and you can find the code together
with install instructions <a
href="http://github.com/kjellm/achoo">here</a>.

<p>To illustrate it's capabilities, I'll walk you through an example
session.

<h3>Register hours</h3>

<div class="CodeRay"><pre style="font-size:medium;">
$ <em>rlwrap achoo</em>         # rlwrap adds some line editing goodness, but you can start it with just 'achoo' as well
Welcome to Achoo!
 1. Register hours
 2. Show flexitime balance
 3. Day hour report
 4. Week hour report
 5. Holiday balance
 6. Lock month
 0. Exit
<strong>[1]&gt;</strong> <em>&lt;enter&gt;</em>
<strong>Date ([today] | ?)&gt;</strong> <em>?</em>
Accepted formats:
         today | (+|-)n | [[[YY]YY]-[M]M]-[D]D

    January 2010         February 2010           March 2010
Mo Tu We Th Fr Sa Su  Mo Tu We Th Fr Sa Su  Mo Tu We Th Fr Sa Su
             1  2  3   1  2  3  4  5  6  7   1  2  3  4  5  6  7
 4  5  6  7  8  9 10   8  9 10 11 12 13 14   8  9 10 11 12 13 14
11 12 13 14 15 16 17  15 16 17 <span style="color:white; background-color:black;">18</span> 19 20 21  15 16 17 18 19 20 21
18 19 20 21 22 23 24  22 23 24 25 26 27 28  22 23 24 25 26 27 28
25 26 27 28 29 30 31                        29 30 31

<strong>Date ([today] | ?)&gt;</strong> <em>&lt;enter&gt;</em>
Recently used projects
 1. p1: NiceCustomer - Consulting
 2. p2: AnnoyingCustomer - Consulting
 3. abs: Absence
 4. var: Various
 0. Other
<strong>Project [1]></strong> <em>2</em>
</pre></div>

<p>If the project you are looking for is not in the list with recently
used projects, select <em>0</em> to get the complete list of your
projects.

<p>When there is only one phase assosiated with the selected project,
achoo will automatically select it and move on. For projects with more
than one phase, you get a menu:

<div class="CodeRay"><pre style="font-size:medium;">
Phases
 1. Cool phase
 2. Boring phase
<strong>Phase ID&gt;</strong> <em>2</em>
VCS logs for 2010-02-18:
--------------------------------<( PROJECT_1 )>--------------------------------
Added breathtaking feature X
Refactored Y
--------------------------------<( PROJECT_2 )>--------------------------------
Made some tests pass
<strong>Remark&gt;</strong> <em>Fixed a lot of awesome stuff</em>
Last log:
Powered on: (0+09:44) Today 06:01 - 15:45
  Awake: (0+00:09) Today 06:01 - 06:10
  Awake: (0+07:44) Today 08:01 - 15:45

<strong>Hours [7:30]&gt;</strong> <em>&lt;enter&gt;</em>
<strong>Do you want to change the defaults for worktime period and/or billing percentage? [N/y]&gt;</strong>  <em>&lt;enter&gt;</em>
      date: "2010-02-18"
   project: "p2: AnnoyingCustomer - Consulting"
     phase: "Boring phase"
    remark: "Fixed a lot of awesome stuff"
     hours: "7.5"
  worktime: "Normal"
   billing: "Normal (100%)"
<strong>Submit? [Y/n]&gt;</strong> <em>y</em>
</pre></div>

<p>Notice that to you get some extra help with registering remark and
hours. Achoo fetches the log for your commits for the given day and
shows you when your laptop has been awake (not suspended).

<h3>Flexi time balance</h3>

<div class="CodeRay"><pre style="font-size:medium;">
 :  ...
 2. Show flexitime balance
 :  ...
[1]&gt; <em>2</em>
<strong>Date ([today] | ?)&gt;</strong> <em>&lt;enter&gt;</em>
Fetching dayview ...
Flexi time balance: <u>2:30</u>
</pre></div>

<h3>Day hour report</h3>

<div class="CodeRay"><pre style="font-size:medium;">
 :  ...
 3. Day hour report
 :  ...
<strong>[1]&gt;</strong> <em>3</em>
<strong>Date ([today] | ?)&gt;</strong> <em>&lt;enter&gt;</em>
+-------------------------------+------------+--------+-------+--------------+----------+--------------------+
| Project                       | Phase      | Remark | Time  | Billing rate | Currency | Billing percentage |
+-------------------------------+------------+--------+-------+--------------+----------+--------------------+
| p1: NiceCustomer - Consulting | Cool phase | Foo    | 07:30 | 1000.00      | NOK      | Normal (100%)      |
+-------------------------------+------------+--------+-------+--------------+----------+--------------------+
</pre></div>

<h3>Week hour report</h3>

<div class="CodeRay"><pre style="font-size:medium;">
 :  ...
 4. Week hour report
 :  ...
<strong>[1]&gt;</strong> <em>4</em>
<strong>Date ([today] | ?)&gt;</strong> <em>&lt;enter&gt;</em>
Fetching weekview ...
<span style="font-size:small">+--------------------------------------------+-------------+-------------+-------------+-------------+------------+------------+------------+-------+
| Project - Phase                            | Mon (02-15) | Tue (02-16) | Wed (02-17) | Thu (02-18) | Fri(02-19) | Sat(02-20) | Sun(02-21) | Total |
+--------------------------------------------+-------------+-------------+-------------+-------------+------------+------------+------------+-------+
| p1: NiceCustomer - Consulting - Nice phase | 7:30        | 2:00        |             |             |            |            |            | 9:30  |
| abs: Absence - Holiday                     |             | 5:30        | 7:30        | 7:30        |            |            |            | 20:30 |
+--------------------------------------------+-------------+-------------+-------------+-------------+------------+------------+------------+-------+
| Total                                      | 7:30        | 7:30        | 7:30        | 7:30        |            |            |            | 29:30 |
+--------------------------------------------+-------------+-------------+-------------+-------------+------------+------------+------------+-------+</span>
</pre></div>

<h3>Holiday balance</h3>

<div class="CodeRay"><pre style="font-size:medium;">
 :  ...
 5. Holiday balance
 :  ...
<strong>[1]&gt;</strong> <em>5</em>
Balance: <u>26,00</u>
</pre></div>

<h3>Lock month</h3>

<p>Achoo selects the previous month as the default

<div class="CodeRay"><pre style="font-size:medium;">
 :  ...
 6. Lock month
 :  ...
<strong>[1]&gt;</strong> <em>6</em>
<strong>Period ([201001] | YYYYMM)&gt;</strong> <em>&lt;enter&gt;</em>
period: 201001
<strong>Submit? [Y/n]&gt;</strong> <em>n</em>
Cancelled
</pre></div>



  <hr>


 
  <div class="date">2009-02-19 11:49 CET</div>

<h2><a href="/bliki/IPv6AdressesAndMysql.html">IPv6 addresses and MySQL</a></h2>


<p>I usually prefer storing IP addresses as integers (unless the DBMS
  have a special data type for it). Using integers gives compact
  storage and makes it easy to answer questions like what is the next
  IP address? In which subnets does it belong? Etc. IPv6 addresses is
  128 bits long, so to store that as an integer in MySQL you need to
  use the <code>DECIMAL</code> data type.

<p>In MySQL there is two functions that help you translate between the
  familiar canonical version and the numeric version of IP addresses:
  INET_ATON() and INET_NTOA(). However these functions do not work
  with IPv6 addresses.

<p>One possible solution to this is to implement INET_ATON6() and
INET_NTOA6() yourself as stored functions:

<h3>INET_ATON6</h3>

<div class="CodeRay">
<pre>DELIMITER //
<span class="r">CREATE</span> FUNCTION INET_ATON6(n <span class="pt">CHAR</span>(<span class="i">39</span>))
RETURNS <span class="pt">DECIMAL</span>(<span class="i">39</span>) <span class="pt">UNSIGNED</span>
DETERMINISTIC
<span class="r">BEGIN</span>
    RETURN <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span>  <span class="i">1</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
                       * <span class="i">5192296858534827628530496329220096</span> <span class="c">-- 65536 ^ 7</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span>  <span class="i">6</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
                       *      <span class="i">79228162514264337593543950336</span> <span class="c">-- 65536 ^ 6</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span> <span class="i">11</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
                       *          <span class="i">1208925819614629174706176</span> <span class="c">-- 65536 ^ 5</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span> <span class="i">16</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>)) 
                       *               <span class="i">18446744073709551616</span> <span class="c">-- 65536 ^ 4</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span> <span class="i">21</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
                       *                    <span class="i">281474976710656</span> <span class="c">-- 65536 ^ 3</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span> <span class="i">26</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
                       *                         <span class="i">4294967296</span> <span class="c">-- 65536 ^ 2</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span> <span class="i">31</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
                       *                              <span class="i">65536</span> <span class="c">-- 65536 ^ 1</span>
         + <span class="pd">CAST</span>(CONV(SUBSTRING(n <span class="r">FROM</span> <span class="i">36</span> FOR <span class="i">4</span>), <span class="i">16</span>, <span class="i">10</span>) <span class="r">AS</span> <span class="pt">DECIMAL</span>(<span class="i">39</span>))
         ;
<span class="r">END</span>;
//
DELIMITER ;
</pre>
</div>

<h3>INET_NTOA6</h3>
<div class="CodeRay">
<pre>DELIMITER //
<span class="r">CREATE</span> FUNCTION INET_NTOA6(n <span class="pt">DECIMAL</span>(<span class="i">39</span>) <span class="pt">UNSIGNED</span>)
RETURNS <span class="pt">CHAR</span>(<span class="i">39</span>)
DETERMINISTIC
<span class="r">BEGIN</span>
  DECLARE a <span class="pt">CHAR</span>(<span class="i">39</span>)             <span class="di">DEFAULT</span> <span class="s"><span class="dl">'</span><span class="dl">'</span></span>;
  DECLARE i <span class="pt">INT</span>                  <span class="di">DEFAULT</span> <span class="i">7</span>;
  DECLARE q <span class="pt">DECIMAL</span>(<span class="i">39</span>) <span class="pt">UNSIGNED</span> <span class="di">DEFAULT</span> <span class="i">0</span>;
  DECLARE r <span class="pt">INT</span>                  <span class="di">DEFAULT</span> <span class="i">0</span>;
  WHILE i DO
    <span class="c">-- DIV doesn't work with nubers &gt; bigint</span>
    <span class="r">SET</span> q <span class="er">:</span>= FLOOR(n / <span class="i">65536</span>);
    <span class="r">SET</span> r <span class="er">:</span>= n MOD <span class="i">65536</span>;
    <span class="r">SET</span> n <span class="er">:</span>= q;
    <span class="r">SET</span> a <span class="er">:</span>= CONCAT_WS(<span class="s"><span class="dl">'</span><span class="k">:</span><span class="dl">'</span></span>, LPAD(CONV(r, <span class="i">10</span>, <span class="i">16</span>), <span class="i">4</span>, <span class="s"><span class="dl">'</span><span class="k">0</span><span class="dl">'</span></span>), a);

    <span class="r">SET</span> i <span class="er">:</span>= i - <span class="i">1</span>;
  <span class="r">END</span> WHILE;

  <span class="r">SET</span> a <span class="er">:</span>= TRIM(TRAILING <span class="s"><span class="dl">'</span><span class="k">:</span><span class="dl">'</span></span> <span class="r">FROM</span> CONCAT_WS(<span class="s"><span class="dl">'</span><span class="k">:</span><span class="dl">'</span></span>,
                                            LPAD(CONV(n, <span class="i">10</span>, <span class="i">16</span>), <span class="i">4</span>, <span class="s"><span class="dl">'</span><span class="k">0</span><span class="dl">'</span></span>),
                                            a));

  RETURN a;

<span class="r">END</span>;
//
DELIMITER ;
</pre>
</div>
<p>The code is to be regarded as a proof of concept as it needs sanity
  checks and handling of simplified address notations before
  production use. However the following small test verifies that it is
  not completely broken:

<div class="CodeRay">
<pre>
mysql> <strong>SELECT INET_NTOA6(INET_ATON6(</strong>
    ->   <strong>'2001:0db8:85a3:0000:0000:8a2e:0370:7334'));</strong>
+-------------------------------------------------------------------+
| INET_NTOA6(INET_ATON6('2001:0db8:85a3:0000:0000:8a2e:0370:7334')) |
+-------------------------------------------------------------------+
| 2001:0DB8:85A3:0000:0000:8A2E:0370:7334                           |
+-------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> <strong>SELECT INET_NTOA6(INET_ATON6(</strong>
    ->   <strong>'ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff'));</strong>
+-------------------------------------------------------------------+
| INET_NTOA6(INET_ATON6('ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff')) |
+-------------------------------------------------------------------+
| FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF                           |
+-------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> <strong>select INET_NTOA6(INET_ATON6(</strong>
    ->   <strong>'0000:0000:0000:0000:0000:0000:0000:0000'));</strong>
+-------------------------------------------------------------------+
| INET_NTOA6(INET_ATON6('0000:0000:0000:0000:0000:0000:0000:0000')) |
+-------------------------------------------------------------------+
| 0000:0000:0000:0000:0000:0000:0000:0000                           |
+-------------------------------------------------------------------+
1 row in set (0.01 sec)
</pre>
</div>


  <hr>


 
  <div class="date">2009-02-13 16:14 CET</div>

<h2><a href="/bliki/ImprovedMuninGraphsForMySQL.html">Improved Munin Graphs for MySQL</a></h2>


<p>Inspired by <a href="http://xaprb.com/">Xaprb's</a> <a
href="http://code.google.com/p/mysql-cacti-templates/">improved graphs
for Cacti</a>, I wrote a plugin that creates similar graphs for <a
href="http://munin.projects.linpro.no/">Munin</a>. 

<p>Hopefully the plugin will be included by the Munin project.  But
until then, or if you want the latest version, you can find download
instructions on my <a href="../code">projects page</a>.

<p>Some features:

<ul>
  <li>Data collected from MySQL is stored in shared memory, thus
    avoiding unnecessary server requests.
  <li>Easy to create new graphs by adding a graph definition to the
    plugin.
</ul>

<hr>

<div style="text-align:center">
  <img src="munin-mysql.png"><br>

  <p><span class="credit">(Thanks to Bart van Bragt for the graphs)</span>
</div>


  <hr>


 
  <div class="date">2008-10-20 20:47 CEST</div>

<h2><a href="/bliki/DrawingGraphsWithRubyGTKCairoAndGraphviz.html">Drawing graphs with Ruby, GTK, Cairo, and Graphviz</a></h2>


<p>Recently I wrote a prototype where I needed a quick solution for
  automatically laying out and drawing undirected graphs. The
  prototype was written in Ruby using GTK for the GUI.

<p>I post here a small program wich illustrates the basics on how this
  can be done, with a hope that it might be useful to others. To save
  some cut n' paste, you can download the source file from <a
  href="../code/">this page</a>.

<p>Here is a sneak peek on the result.

<div class="illustration"><img src="drawing_graphs.png" alt="The result"></div>

<p>First we need a simple example graph to work with. Let us define a
  graph as an array of edges. Each edge is an array with two vertices,
  represented by symbols.

<div class="CodeRay">
<pre><span class="dt">#!/usr/bin/env ruby -w</span>

edges = [[<span class="sy">:a</span>, <span class="sy">:b</span>], 
         [<span class="sy">:a</span>, <span class="sy">:c</span>], 
         [<span class="sy">:b</span>, <span class="sy">:c</span>], 
         [<span class="sy">:c</span>, <span class="sy">:d</span>],
         [<span class="sy">:d</span>, <span class="sy">:e</span>],
         [<span class="sy">:d</span>, <span class="sy">:f</span>],
         [<span class="sy">:e</span>, <span class="sy">:f</span>],
        ]

</pre>
</div>
<p>The next thing is to calculate a layout of the vertices. To do this
  I use the neato command from <a
  href="http://graphviz.org">Graphviz</a>. Neato is a program for
  drawing undirected graphs. Graphviz expects its input to be in the
  <a href="http://en.wikipedia.org/wiki/DOT_language">dot
  language</a>.

<div class="CodeRay">
<pre>dot = <span class="s"><span class="dl">&quot;</span><span class="k">graph Test {</span><span class="ch">\n</span><span class="dl">&quot;</span></span>
edges.each <span class="r">do</span> |edge|
  dot &lt;&lt; <span class="s"><span class="dl">&quot;</span><span class="k">    </span><span class="il"><span class="idl">#{</span>edge[<span class="i">0</span>].to_s<span class="idl">}</span></span><span class="k"> -- </span><span class="il"><span class="idl">#{</span>edge[<span class="i">1</span>].to_s<span class="idl">}</span></span><span class="k">;</span><span class="ch">\n</span><span class="dl">&quot;</span></span>
<span class="r">end</span>
dot &lt;&lt; <span class="s"><span class="dl">&quot;</span><span class="k">}</span><span class="ch">\n</span><span class="dl">&quot;</span></span>
</pre>
</div>
<p>Interaction with neato is done using a pipe, and giving it the
  argument <code>-Tplain</code> produces a graph to stdout with layout
  information. The output format is described <a
  href="http://www.graphviz.org/cvs/doc/info/output.html#d:plain">here</a>.

<div class="CodeRay">
<pre>layout = <span class="co">IO</span>.popen(<span class="s"><span class="dl">'</span><span class="k">neato -Tplain</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">r+</span><span class="dl">'</span></span>) <span class="r">do</span> |pipe|
  pipe.write(dot)
  pipe.close_write
  pipe.read
<span class="r">end</span>
</pre>
</div>
<p>Before we proceed, we need to define some variables. Their use
  should be fairly obvious later on.

<div class="CodeRay">
<pre>vertex_coordinates = {}
padding            = <span class="i">20</span>
scale              = <span class="i">100</span>
</pre>
</div>
<p>Now we can parse the layout information.

<div class="CodeRay">
<pre>layout.each <span class="r">do</span> |line|
  <span class="r">if</span> line =~ <span class="rx"><span class="dl">/</span><span class="k">^node (</span><span class="ch">\w</span><span class="k">+)  ([</span><span class="ch">\d</span><span class="k">.]+) ([</span><span class="ch">\d</span><span class="k">.]+)</span><span class="dl">/</span></span>
    vertex_coordinates[<span class="gv">$1</span>.to_sym] = [<span class="gv">$2</span>.to_f * scale + padding, 
                                     <span class="gv">$3</span>.to_f * scale + padding]
  <span class="r">end</span>
<span class="r">end</span>
</pre>
</div>
<p>Then we create a window to put the drawing inside, using the <a
  href="http://ruby-gnome2.sourceforge.jp/">gtk2</a> library.

<div class="CodeRay">
<pre>require <span class="s"><span class="dl">'</span><span class="k">gtk2</span><span class="dl">'</span></span>

window = <span class="co">Gtk</span>::<span class="co">Window</span>.new(<span class="s"><span class="dl">'</span><span class="k">Graph</span><span class="dl">'</span></span>)
window.set_default_size(<span class="i">400</span>, <span class="i">400</span>)

window.signal_connect(<span class="s"><span class="dl">'</span><span class="k">destroy</span><span class="dl">'</span></span>) <span class="r">do</span>
  <span class="co">Gtk</span>.main_quit
<span class="r">end</span>
</pre>
</div>
<p>And here is the code which draws the graph. The code uses the <a
  href="http://www.cairographics.org/">Cairo</a> vector drawing
  library in a GTK::DrawingArea.

<div class="CodeRay">
<pre>area = <span class="co">Gtk</span>::<span class="co">DrawingArea</span>.new
area.signal_connect(<span class="s"><span class="dl">'</span><span class="k">expose_event</span><span class="dl">'</span></span>) <span class="r">do</span>
  context = area.window.create_cairo_context

  <span class="c"># Draw the edges as straight lines between the centers of the</span>
  <span class="c"># vertices.</span>
  edges.each <span class="r">do</span> |edge|
    context.move_to(*vertex_coordinates[edge[<span class="i">0</span>]])
    context.line_to(*vertex_coordinates[edge[<span class="i">1</span>]])
    context.stroke
  <span class="r">end</span>

  vertex_coordinates.each <span class="r">do</span> |v, c|
    <span class="c"># Draw the vertex as a circle filled with white (this hides</span>
    <span class="c"># the edges underneath)</span>
    context.arc(c[<span class="i">0</span>], c[<span class="i">1</span>], <span class="i">20</span>, <span class="i">0</span>, <span class="fl">2.0</span> * <span class="co">Math</span>::<span class="co">PI</span>)
    context.set_source_rgb(<span class="i">1</span>, <span class="i">1</span>, <span class="i">1</span>)
    context.fill_preserve()
    context.set_source_rgb(<span class="i">0</span>, <span class="i">0</span>, <span class="i">0</span>)
    context.stroke

    <span class="c"># Draw the vertex labels</span>
    context.set_font_size(<span class="i">16</span>)
    context.select_font_face(<span class="s"><span class="dl">'</span><span class="k">Arial</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">normal</span><span class="dl">'</span></span>, <span class="s"><span class="dl">'</span><span class="k">bold</span><span class="dl">'</span></span>);
    context.move_to(c[<span class="i">0</span>] - <span class="i">6</span>, c[<span class="i">1</span>] + <span class="i">5</span>)
    context.show_text(v.to_s.upcase)
    context.stroke
  <span class="r">end</span>
<span class="r">end</span>
</pre>
</div>
<p>Finally we add the drawing to the window and start the application.

<div class="CodeRay">
<pre>window.add(area)
window.show_all

<span class="co">Gtk</span>.main
</pre>
</div>
<p>THE END


  <hr>


 
  <div class="date">2008-09-18 20:22 CEST</div>

<h2><a href="/bliki/MissingValuesInSQL.html">Missing values in SQL</a></h2>


<div class="notice">
  <p>This article is part of a series
  on <a href="SelectedTopicsOnDatabaseManagementSystems.html">selected
  topics on database management systems</a>
</div>


<p>In SQL we use NULL as a placeholder for missing values. It has at least 
three different uses.

<ol>
  <li>To mark a value in a column as 'missing'.

  <li>As placeholders in the result of
    an <a href="http://en.wikipedia.org/wiki/Join_(SQL)#Outer_joins">outer
    join</a> where 'no match' are found between rows.

  <li>As the result of arithmetic operations with one or more operands
    that are NULL. Here a NULL means 'unknown', unknown because
    information that is needed for evaluating the expression is
    missing.
</ol>

<p>If a value in a column is NULL, all you know is that it is
  missing. If you need to know why, you can store that information in
  a separate column. Another approach is to disallow NULLs and use an
  encoding that has distinct values for missing data. An example is
  the standard encoding for gender: <a
  href="http://en.wikipedia.org/wiki/ISO_5218">ISO 5218</a>.

<p>The usage of NULL is one of the big controversies in SQL and
  relational systems. Some feels that it introduces unnecessary
  complexity, and the general advice seems to be to use NULLs only
  when there is no better option.

<h3>Reasons to avoid NULL</h3>

<ul>

  <li>NULL behaves differently from similar non-value markers in most
    programming languages.

  <li>Some confuses NULL with the empty string, zero, or false.

  <li>NULLs introduces 3-valued logic. That is, in addition to TRUE
    and FALSE you also have UNKNOWN, a source of many
    misunderstandings and errors in SQL statements.

  <li>Many functions treat NULL in a special manner. To remember how
    NULL is handled by different functions is painful. Some examples:
    GROUP BY puts all rows with NULLs in the same group, thous
    treating them equal when in fact the equality is unknown. The SUM
    aggregate function ignores NULLs when summarizing the values of a
    column.

  <li>Having columns that might be NULL in a table, typically
    introduces a penalty on performance.

  <li>Mistakes are Easily made when dealing with ALL, ANY, IN, and
    EXISTS queries.

  <li>Having many nullable columns in a table might indicate that the
    table is not properly <a
    href="http://en.wikipedia.org/wiki/Database_normalization">normalized</a>.

</ul>

<h3>Reasons to use NULL</h3>

<ul>

  <li>It is a good idea to allow NULL when you need to mark a value as
  missing and there is no easy way handle missing values in any
  reasonable encoding for the column. Just be aware that you don't
  fall in any of the traps mentioned above.

</ul>

<h3>Read more</h3>

<ul class="bibliography">

  <li>Celcko, J. (2005), <em>SQL For Smarties</em>, San Francisco: Morgan Kaufman<br>
  Chapter 6
  

  <li>Celcko, J. (2005), <em>SQL Programming Style</em>, San Francisco: Morgan Kaufman<br>
  Chapter 5.3.3

  <li>Garcia-Molina, H., Ullman, J., &amp; Widom, J. (2002), <em>Database
  systems: The complete book</em>, New Jersey: Prentice Hall<br>
  Chapter 6.1.5

  <li><em><a href="http://en.wikipedia.org/wiki/Null_%28SQL%29">Null (SQL)</a></em>, Wikipedia

  <li><em><a href="http://en.wikipedia.org/wiki/Null_%28SQL%29#Controversy">Null (SQL) :: Controversy</a></em>, Wikipedia

  <li>de Haan, L., Gennick, J. (2005), <em><a href="http://www.oracle.com/technology/oramag/oracle/05-jul/o45sql.html">Nulls: Nothing to Worry About</a></em>, Oracle Magazinea
</ul>


  <hr>


 
  <div class="date">2008-09-10 20:22 CEST</div>

<h2><a href="/bliki/NaturalVsSurrogatePrimaryKeys.html">Natural vs surrogate primary keys</a></h2>


<div class="notice">
  <p>This article is part of a series
  on <a href="SelectedTopicsOnDatabaseManagementSystems.html">selected
  topics on database management systems</a>
</div>


<p>To identify the different records in a relational table, we use a
primary key. There are two kinds of primary keys with very different
characteristics. A <a href="http://en.wikipedia.org/wiki/Natural_key"><em>natural
key</em></a> uses a column or columns that are a natural part of a
record, while
a <a href="http://en.wikipedia.org/wiki/Surrogate_key"><em>surrogate
key</em></a> is added to the record and uses artificial data. When
choosing your strategy, it is important to be aware of the advantages
and disadvantages.

<p>The main advantage of a natural key is that it can be verified by
comparing it with real world data. This is how users of the system
typically will identify data.

<p>A surrogate key on the other hand has the advantage of being more
robust to changes in how we identify the records in the real
world. When the natural key changes (e.g. because of changes in
business requirements), you don't have to change all your internal
references to the record.

<p>It is also more efficient for the database system to use surrogate
keys. This is true especially when joining on the primary keys, or if
the system uses clustered primary key indexes.

<p>Since a surrogate key normally is internal to a system, it can't
be used to reference entities in external systems.

<p>There should always be maintained a natural key in a table even if
a surrogate key is chosen as the primary. If not, the records will
loose their connection to the real world. But be aware that the two
keys might get out of sync without you noticing it.


<h3>Read more</h3>

<ul class="bibliography">
  <li>Celko, J. (2005), <em>SQL Programming Style</em>, San Francisco: Morgan Kaufmann<br>
    Chapter 3.13

  <li>Ambler S. W., <em><a
  href="http://www.agiledata.org/essays/keys.html">Choosing a Primary
  Key: Natural or Surrogate?</a></em>, Agile Data

  <li>Richardson L. (2007), <em><a
  href="http://rapidapplicationdevelopment.blogspot.com/2007/08/in-case-youre-new-to-series-ive.html">Surrogate
  vs Natural Primary Keys – Data Modeling Mistake 2 of 10</a></em>,
  Rapid Application Development Blog
</ul>


  <hr>



    </div>
  </body>
</html>
